!function Ul(Hl){var Gl=Hl.document;!function(l,t,y,_,n){var o="default"in l?l.default:l;t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var e="default"in y?y.default:y,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var s=Math.floor(399),a="ready",c="ready-for-browser-manipulation",u={click:"click",rightClick:"right-click",doubleClick:"double-click",drag:"drag",dragToElement:"drag-to-element",hover:"hover",typeText:"type-text",selectText:"select-text",selectTextAreaContent:"select-text-area-content",selectEditableContent:"select-editable-content",pressKey:"press-key",wait:"wait",navigateTo:"navigate-to",setFilesToUpload:"set-files-to-upload",clearUpload:"clear-upload",executeClientFunction:"execute-client-function",executeSelector:"execute-selector",takeScreenshot:"take-screenshot",takeElementScreenshot:"take-element-screenshot",takeScreenshotOnFail:"take-screenshot-on-fail",prepareBrowserManipulation:"prepare-browser-manipulation",showAssertionRetriesStatus:"show-assertion-retries-status",hideAssertionRetriesStatus:"hide-assertion-retries-status",setBreakpoint:"set-breakpoint",resizeWindow:"resize-window",resizeWindowToFitDevice:"resize-window-to-fit-device",maximizeWindow:"maximize-window",switchToIframe:"switch-to-iframe",switchToMainWindow:"switch-to-main-window",openWindow:"open-window",closeWindow:"close-window",getCurrentWindow:"get-current-window",switchToWindow:"switch-to-window",switchToParentWindow:"switch-to-parent-window",setNativeDialogHandler:"set-native-dialog-handler",getNativeDialogHistory:"get-native-dialog-history",getBrowserConsoleMessages:"get-browser-console-messages",setTestSpeed:"set-test-speed",setPageLoadTimeout:"set-page-load-timeout",debug:"debug",assertion:"assertion",useRole:"useRole",testDone:"test-done",backupStorages:"backup-storages",executeExpression:"execute-expression",executeAsyncExpression:"execute-async-expression",unlockPage:"unlock-page",recorder:"recorder"},d="E1",h="E2",f="E3",m="E4",p="E5",g="E6",v="E7",w="E8",E="E9",C="E10",I="E11",S="E12",T="E14",b="E15",W="E16",x="E17",D="E18",R="E19",N="E20",M="E21",P="E22",A="E23",k="E24",F="E26",L="E27",O="E28",U="E29",H="E30",G="E31",B="E32",V="E33",z="E34",X="E35",j="E36",q="E37",Y="E38",K="E39",J="E40",$="E41",Q="E42",Z="E43",tt="E44",et="E45",nt="E46",rt="E47",it="E48",ot="E49",st="E50",at="E51",lt="E52",ct="E53",ut="E54",dt="E55",ht="E56",ft="E57",mt="E58",pt="E59",gt="E60",vt="E61",wt="E62",yt="E63",_t="E64",Et="E65",Ct="E66",It="E67",St="E68",Tt="E69",bt="E70",Wt="E71",xt="E72",Dt="E73",Rt="E74",Nt="E75";function Mt(t){return!(function(t){return t.type===u.executeClientFunction||t.type===u.executeSelector}(r=t)||r.type===u.wait||r.type===u.assertion||r.type===u.executeExpression||At(t)||(n=t).type===u.testDone||n.type===u.showAssertionRetriesStatus||n.type===u.hideAssertionRetriesStatus||n.type===u.setBreakpoint||n.type===u.takeScreenshotOnFail||n.type===u.recorder)||Pt(t)&&!((e=t).type===u.switchToIframe||e.type===u.switchToMainWindow);var e,n,r}function Pt(t){return t.type===u.resizeWindow||t.type===u.resizeWindowToFitDevice||t.type===u.maximizeWindow}function At(t){return(e=t).type===u.takeScreenshot||e.type===u.takeElementScreenshot||e.type===u.takeScreenshotOnFail||Pt(t);var e}function kt(t){this.code=t,this.isTestCafeError=!0,this.callsite=null}var Ft,Lt=(i(Ot,Ft=kt),Ot);function Ot(t,e,n){var r=Ft.call(this,t)||this;return r.optionName=e,r.actualValue=n,r}var Ut,Ht,Gt=(i(Bt,Ut=kt),Bt);function Bt(t,e,n){var r=Ut.call(this,t)||this;return r.argumentName=e,r.actualValue=n,r}function Vt(t){var e=Ht.call(this,w)||this;return e.callsite=t,e}i(Vt,Ht=kt);var zt,Xt=(i(jt,zt=kt),jt);function jt(t){var e=zt.call(this,ot)||this;return e.instantiationCallsiteName=t,e}var qt,Yt=(i(Kt,qt=kt),Kt);function Kt(t){var e=qt.call(this,st)||this;return e.instantiationCallsiteName=t,e}var Jt,$t=(i(Qt,Jt=kt),Qt);function Qt(t,e){var n=e.apiFnChain,r=e.apiFnIndex,i=Jt.call(this,t)||this;return i.apiFnChain=n,i.apiFnIndex=r,i}var Zt,te=(i(ee,Zt=kt),ee);function ee(){return Zt.call(this,at)||this}var ne,re,ie=(i(oe,ne=$t),oe);function oe(t,e){var n=ne.call(this,lt,e)||this;return n.callsite=t,n}function se(t,e){var n=re.call(this,ut)||this;return n.url=e,n.errMsg=t,n}i(se,re=kt);var ae,le,ce,ue=(i(de,ae=kt),de);function de(t,e){var n=ae.call(this,d)||this;return n.errStack=t,n.pageDestUrl=e,n}function he(t,e){var n=le.call(this,h)||this;return n.errMsg=String(t.rawMessage||t),n.callsite=t.callsite||e,n.originError=t,n}function fe(t){var e=ce.call(this,f)||this;return e.objType=typeof t,e.objStr=String(t),e}i(he,le=kt),i(fe,ce=kt);var me,pe=(i(ge,me=kt),ge);function ge(t,e){var n=me.call(this,m)||this;return n.errMsg=String(e),n.instantiationCallsiteName=t,n}var ve,we,ye,_e=(i(Ee,ve=kt),Ee);function Ee(t,e,n){var r=ve.call(this,p,e,n)||this;return r.errMsg=String(e),r.property=n,r.instantiationCallsiteName=t,r}function Ce(t){var e=we.call(this,g)||this;return e.errMsg=String(t),e}function Ie(t){var e=ye.call(this,v)||this;return e.errMsg=String(t),e}i(Ce,we=kt),i(Ie,ye=kt);var Se,Te=(i(be,Se=kt),be);function be(t){var e=Se.call(this,_t)||this;return e.errMsg=String(t),e}var We,xe,De,Re,Ne,Me=(i(Pe,We=kt),Pe);function Pe(t,e){var n=We.call(this,Et)||this;return n.errMsg=String(t),n.moduleName=e,n}function Ae(t,e){var n=xe.call(this,ct)||this;return n.errMsg=String(t),n.callsite=e,n}function ke(t,e,n,r){var i=De.call(this,pt,t,e)||this;return i.errMsg=r?n.rawMessage:n.message,i.originError=n,i}function Fe(t){var e=Re.call(this,gt)||this;return e.callsite=t,e}function Le(t){var e=Ne.call(this,vt)||this;return e.callsite=t,e}i(Ae,xe=kt),i(ke,De=Gt),i(Fe,Re=kt),i(Le,Ne=kt);var Oe,Ue=(i(He,Oe=Lt),He);function He(t,e){return Oe.call(this,E,t,e)||this}var Ge,Be=(i(Ve,Ge=Lt),Ve);function Ve(t,e){return Ge.call(this,C,t,e)||this}var ze,Xe,je=(i(qe,ze=Lt),qe);function qe(t,e){return ze.call(this,I,t,e)||this}function Ye(t,e){return Xe.call(this,b,t,e)||this}i(Ye,Xe=Gt);var Ke,Je,$e,Qe,Ze,tn,en,nn,rn,on,sn,an,ln=(i(cn,Ke=Lt),cn);function cn(t,e){return Ke.call(this,S,t,e)||this}function un(t){var e=Je.call(this,T)||this;return e.actualType=t,e}function dn(t,e){return $e.call(this,W,t,e)||this}function hn(t,e){return Qe.call(this,x,t,e)||this}function fn(t,e){return Ze.call(this,N,t,e)||this}function mn(t,e){return tn.call(this,M,t,e)||this}function pn(t,e){return en.call(this,P,t,e)||this}function gn(t,e){return nn.call(this,D,t,e)||this}function vn(t,e,n){var r=rn.call(this,R,t,e)||this;return r.elementIndex=n,r}function wn(t,e){return on.call(this,rt,t,e)||this}function yn(t,e){return sn.call(this,Y,t,e)||this}function _n(t,e,n){var r=an.call(this,A)||this;return r.selectorName=t,r.errMsg=n?e.rawMessage:e.message,r.originError=e,r}i(un,Je=kt),i(dn,$e=Gt),i(hn,Qe=Gt),i(fn,Ze=Gt),i(mn,tn=Gt),i(pn,en=Gt),i(gn,nn=Gt),i(vn,rn=Gt),i(wn,on=Gt),i(yn,sn=Gt),i(_n,an=kt);var En,Cn=(i(In,En=$t),In);function In(t){return En.call(this,k,t)||this}var Sn,Tn=(i(bn,Sn=kt),bn);function bn(){return Sn.call(this,F)||this}var Wn,xn=(i(Dn,Wn=kt),Dn);function Dn(t){var e=Wn.call(this,L)||this;return e.nodeDescription=t,e}var Rn,Nn=(i(Mn,Rn=$t),Mn);function Mn(t,e){var n=Rn.call(this,O,e)||this;return n.argumentName=t,n}var Pn,An=(i(kn,Pn=kt),kn);function kn(t){var e=Pn.call(this,U)||this;return e.argumentName=t,e}var Fn,Ln=(i(On,Fn=kt),On);function On(t,e){var n=Fn.call(this,H)||this;return n.argumentName=t,n.nodeDescription=e,n}var Un,Hn=(i(Gn,Un=kt),Gn);function Gn(){return Un.call(this,G)||this}var Bn,Vn=(i(zn,Bn=kt),zn);function zn(){return Bn.call(this,B)||this}var Xn,jn=(i(qn,Xn=kt),qn);function qn(t){var e=Xn.call(this,V)||this;return e.argumentName=t,e}var Yn,Kn=(i(Jn,Yn=kt),Jn);function Jn(){return Yn.call(this,X)||this}var $n,Qn=(i(Zn,$n=kt),Zn);function Zn(t){var e=$n.call(this,j)||this;return e.argumentName=t,e}var tr,er=(i(nr,tr=kt),nr);function nr(t,e){var n=tr.call(this,q)||this;return n.filePaths=t,n.scannedFilePaths=e,n}var rr,ir=(i(or,rr=kt),or);function or(){return rr.call(this,z)||this}var sr,ar,lr,cr,ur=(i(dr,sr=kt),dr);function dr(t,e){var n=sr.call(this,$)||this;return n.properties=t?"scrollTargetY property":e?"scrollTargetX property":"scrollTargetX and scrollTargetY properties",n}function hr(t,e,n,r,i){var o=ar.call(this,Ct)||this;return o.callsite=i,o.expression=e,o.line=n,o.column=r,o.originError=t,o.errMsg=t.message||String(t),o}function fr(t,e,n,r,i){var o=lr.call(this,It)||this;return o.callsite=i,o.expression=e,o.line=n,o.column=r,o.originError=t,o.errCallsite=t.callsite,o}function mr(t){var e=cr.call(this,dt)||this;return e.callsite=t,e}i(hr,ar=kt),i(fr,lr=kt),i(mr,cr=kt);var pr,gr,vr,wr=(i(yr,pr=kt),yr);function yr(t,e){var n=pr.call(this,ft)||this;return t<=0?e<=0?(n.verb="are",n.dimensions="width and height"):(n.verb="is",n.dimensions="width"):(n.verb="is",n.dimensions="height"),n}function _r(t,e){var n=gr.call(this,ht)||this;return n.screenshotPath=t,n.forbiddenCharsList=e,n}function Er(t){var e=vr.call(this,mt)||this;return e.callsite=t,e}i(_r,gr=kt),i(Er,vr=kt);var Cr,Ir=(i(Sr,Cr=kt),Sr);function Sr(){return Cr.call(this,J)||this}var Tr,br=(i(Wr,Tr=kt),Wr);function Wr(){return Tr.call(this,K)||this}var xr,Dr=(i(Rr,xr=kt),Rr);function Rr(){return xr.call(this,Q)||this}var Nr,Mr=(i(Pr,Nr=kt),Pr);function Pr(){return Nr.call(this,Tt)||this}var Ar,kr=(i(Fr,Ar=kt),Fr);function Fr(){return Ar.call(this,St)||this}var Lr,Or=(i(Ur,Lr=kt),Ur);function Ur(){return Lr.call(this,bt)||this}var Hr,Gr=(i(Br,Hr=kt),Br);function Br(){return Hr.call(this,Wt)||this}var Vr,zr,Xr,jr=(i(qr,Vr=kt),qr);function qr(t){return Vr.call(this,t)||this}function Yr(){return zr.call(this,Rt)||this}function Kr(){return Xr.call(this,Dt)||this}i(Yr,zr=jr),i(Kr,Xr=jr);var Jr,$r=(i(Qr,Jr=kt),Qr);function Qr(){return Jr.call(this,Z)||this}var Zr,ti=(i(ei,Zr=kt),ei);function ei(){return Zr.call(this,tt)||this}var ni,ri=(i(ii,ni=kt),ii);function ii(t,e){var n=ni.call(this,et)||this;return n.dialogType=t,n.pageUrl=e,n}var oi,si,ai,li,ci=(i(ui,oi=kt),ui);function ui(t,e,n){var r=oi.call(this,nt)||this;return r.dialogType=t,r.errMsg=e,r.pageUrl=n,r}function di(t){var e=si.call(this,it)||this;return e.actualType=t,e}function hi(t,e,n){var r=ai.call(this,yt)||this;return r.errMsg=String(t),r.hookClassName=e,r.methodName=n,r}function fi(t,e){var n=li.call(this,wt)||this;return n.methodName=t,n.hookClassName=e,n}i(di,si=kt),i(hi,ai=kt),i(fi,li=kt);var mi,pi,gi=(i(vi,mi=kt),vi);function vi(){return mi.call(this,xt)||this}function wi(t){var e=pi.call(this,Nt)||this;return e.methodName=t,e}i(wi,pi=kt);var yi=(_i.prototype.ensureMessageContainer=function(t){this[t]||(this[t]={log:[],info:[],warn:[],error:[]})},_i.prototype.concat=function(e){var n=this;return e&&Object.keys(e).forEach(function(t){n.ensureMessageContainer(t),n[t].log=n[t].log.concat(e[t].log),n[t].info=n[t].info.concat(e[t].info),n[t].warn=n[t].warn.concat(e[t].warn),n[t].error=n[t].error.concat(e[t].error)}),this},_i.prototype.addMessage=function(t,e,n){this.ensureMessageContainer(n),this[n][t].push(e)},_i.prototype.getCopy=function(){var e=this,n={};return Object.keys(this).forEach(function(t){n[t]={log:e[t].log.slice(),info:e[t].info.slice(),warn:e[t].warn.slice(),error:e[t].error.slice()}}),n},_i);function _i(t){this.concat(t)}var Ei=(Ci.prototype._getAssignableProperties=function(){throw new Error("Not implemented")},Ci.prototype._assignFrom=function(t,e,n){if(void 0===n&&(n={}),t)for(var r=this._getAssignableProperties(),i=0;i<r.length;i++){for(var o,s=r[i],a=s.name,l=s.type,c=s.required,u=s.init,d=s.defaultValue,h=a.split("."),f=h.length-1,m=h[f],p=t,g=this,v=0;v<f&&p&&g;v++)p=p[h[v]],g=g[h[v]];g&&"defaultValue"in r[i]&&(g[a]=d),p&&g&&(void 0===(o=p[m])&&!c||(e&&l&&l(a,o),g[m]=u?u(a,o,n):o))}},Ci);function Ci(){}function Ii(){return l.nativeMethods.performanceNow().toString()}var Si,Ti=(i(bi,Si=Ei),bi.prototype._getAssignableProperties=function(){return[{name:"isCommandResult"},{name:"executionError"},{name:"pageError"},{name:"result"},{name:"consoleMessages"},{name:"isPendingWindowSwitching"},{name:"isFirstRequestAfterWindowSwitching"}]},bi);function bi(t){var e=Si.call(this,t)||this;return e.id=Ii(),e.isCommandResult=!1,e.executionError=null,e.pageError=null,e.resent=!1,e.result=null,e.consoleMessages=null,e.isPendingWindowSwitching=!1,e.isFirstRequestAfterWindowSwitching=!1,e._assignFrom(t,!0),e}var Wi,xi=(function(t){function r(t,e){this.references=t,this.transforms=e,this.circularCandidates=[],this.circularCandidatesDescrs=[],this.circularRefCount=0}var o=/^#*@(t|r)$/,i=(0,eval)("this"),n="function"==typeof ArrayBuffer,s="function"==typeof Map,a="function"==typeof Set,l=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"],c=Array.prototype.slice,e={serialize:function(t){return JSON.stringify(t)},deserialize:function(t){return JSON.parse(t)}};function u(t,e){this.references=t,this.transformMap=e,this.activeTransformsStack=[],this.visitedRefs=Object.create(null)}r._createRefMark=function(t){var e=Object.create(null);return e["@r"]=t,e},r.prototype._createCircularCandidate=function(t,e,n){this.circularCandidates.push(t),this.circularCandidatesDescrs.push({parent:e,key:n,refIdx:-1})},r.prototype._applyTransform=function(t,e,n,r){var i=Object.create(null),o=r.toSerializable(t);return"object"==typeof o&&this._createCircularCandidate(t,e,n),i["@t"]=r.type,i.data=this._handleValue(o,e,n),i},r.prototype._handleArray=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=this._handleValue(t[n],e,n);return e},r.prototype._handlePlainObject=function(n){var r=this,i=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){var e=o.test(t)?"#"+t:t;i[e]=r._handleValue(n[t],i,e)}),i},r.prototype._handleObject=function(t,e,n){return this._createCircularCandidate(t,e,n),Array.isArray(t)?this._handleArray(t):this._handlePlainObject(t)},r.prototype._ensureCircularReference=function(t){var e=this.circularCandidates.indexOf(t);if(-1<e){var n=this.circularCandidatesDescrs[e];return-1===n.refIdx&&(n.refIdx=n.parent?++this.circularRefCount:0),r._createRefMark(n.refIdx)}return null},r.prototype._handleValue=function(t,e,n){var r=typeof t,i="object"==r&&null!==t;if(i){var o=this._ensureCircularReference(t);if(o)return o}for(var s=0;s<this.transforms.length;s++){var a=this.transforms[s];if(a.shouldTransform(r,t))return this._applyTransform(t,e,n,a)}return i?this._handleObject(t,e,n):t},r.prototype.transform=function(){for(var t=[this._handleValue(this.references,null,null)],e=0;e<this.circularCandidatesDescrs.length;e++){var n=this.circularCandidatesDescrs[e];0<n.refIdx&&(t[n.refIdx]=n.parent[n.key],n.parent[n.key]=r._createRefMark(n.refIdx))}return t},u.prototype._handlePlainObject=function(e){var n=this,r=Object.create(null),t=Object.getOwnPropertyNames(e);for(var i in t.forEach(function(t){n._handleValue(e[t],e,t),o.test(t)&&(r[t.substring(1)]=e[t],delete e[t])}),r)e[i]=r[i]},u.prototype._handleTransformedObject=function(t,e,n){var r=t["@t"],i=this.transformMap[r];if(!i)throw new Error("Can't find transform for \""+r+'" type.');this.activeTransformsStack.push(t),this._handleValue(t.data,t,"data"),this.activeTransformsStack.pop(),e[n]=i.fromSerializable(t.data)},u.prototype._handleCircularSelfRefDuringTransform=function(t,e,n){var r=this.references,i=void 0;Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){return void 0===i&&(i=r[t]),i},set:function(t){return i=t}})},u.prototype._handleCircularRef=function(t,e,n){-1<this.activeTransformsStack.indexOf(this.references[t])?this._handleCircularSelfRefDuringTransform(t,e,n):(this.visitedRefs[t]||(this.visitedRefs[t]=!0,this._handleValue(this.references[t],this.references,t)),e[n]=this.references[t])},u.prototype._handleValue=function(t,e,n){if("object"==typeof t&&null!==t){var r=t["@r"];if(void 0!==r)this._handleCircularRef(r,e,n);else if(t["@t"])this._handleTransformedObject(t,e,n);else if(Array.isArray(t))for(var i=0;i<t.length;i++)this._handleValue(t[i],t,i);else this._handlePlainObject(t)}},u.prototype.transform=function(){return this.visitedRefs[0]=!0,this._handleValue(this.references[0],this.references,0),this.references[0]};var d=[{type:"[[NaN]]",shouldTransform:function(t,e){return"number"===t&&isNaN(e)},toSerializable:function(){return""},fromSerializable:function(){return NaN}},{type:"[[undefined]]",shouldTransform:function(t){return"undefined"===t},toSerializable:function(){return""},fromSerializable:function(){}},{type:"[[Date]]",shouldTransform:function(t,e){return e instanceof Date},toSerializable:function(t){return t.getTime()},fromSerializable:function(t){var e=new Date;return e.setTime(t),e}},{type:"[[RegExp]]",shouldTransform:function(t,e){return e instanceof RegExp},toSerializable:function(t){var e={src:t.source,flags:""};return t.global&&(e.flags+="g"),t.ignoreCase&&(e.flags+="i"),t.multiline&&(e.flags+="m"),e},fromSerializable:function(t){return new RegExp(t.src,t.flags)}},{type:"[[Error]]",shouldTransform:function(t,e){return e instanceof Error},toSerializable:function(t){return{name:t.name,message:t.message,stack:t.stack}},fromSerializable:function(t){var e=new(i[t.name]||Error)(t.message);return e.stack=t.stack,e}},{type:"[[ArrayBuffer]]",shouldTransform:function(t,e){return n&&e instanceof ArrayBuffer},toSerializable:function(t){var e=new Int8Array(t);return c.call(e)},fromSerializable:function(t){if(n){var e=new ArrayBuffer(t.length);return new Int8Array(e).set(t),e}return t}},{type:"[[TypedArray]]",shouldTransform:function(t,e){for(var n=0;n<l.length;n++){var r=l[n];if("function"==typeof i[r]&&e instanceof i[r])return!0}return!1},toSerializable:function(t){return{ctorName:t.constructor.name,arr:c.call(t)}},fromSerializable:function(t){return"function"==typeof i[t.ctorName]?new i[t.ctorName](t.arr):t.arr}},{type:"[[Map]]",shouldTransform:function(t,e){return s&&e instanceof Map},toSerializable:function(t){var n=[];return t.forEach(function(t,e){n.push(e),n.push(t)}),n},fromSerializable:function(t){if(s){for(var e=new Map,n=0;n<t.length;n+=2)e.set(t[n],t[n+1]);return e}for(var r=[],i=0;i<t.length;i+=2)r.push([t[n],t[n+1]]);return r}},{type:"[[Set]]",shouldTransform:function(t,e){return a&&e instanceof Set},toSerializable:function(t){var e=[];return t.forEach(function(t){e.push(t)}),e},fromSerializable:function(t){if(a){for(var e=new Set,n=0;n<t.length;n++)e.add(t[n]);return e}return t}}],h=t.exports=function(t){this.transforms=[],this.transformsMap=Object.create(null),this.serializer=t||e,this.addTransforms(d)};h.prototype.addTransforms=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++){var n=t[e];if(this.transformsMap[n.type])throw new Error('Transform with type "'+n.type+'" was already added.');this.transforms.push(n),this.transformsMap[n.type]=n}return this},h.prototype.removeTransforms=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++){var n=t[e],r=this.transforms.indexOf(n);-1<r&&this.transforms.splice(r,1),delete this.transformsMap[n.type]}return this},h.prototype.encode=function(t){var e=new r(t,this.transforms).transform();return this.serializer.serialize(e)},h.prototype.decode=function(t){var e=this.serializer.deserialize(t);return new u(e,this.transformsMap).transform()}}(Wi={exports:{}}),Wi.exports);function Di(t,e){return new l.nativeMethods.Function("fnCode","__dependencies$","Promise",'"use strict"; return eval(fnCode)')(t,e,l.Promise)}var Ri=["nodeType","textContent","childNodeCount","hasChildNodes","childElementCount","hasChildElements"],Ni=["tagName","attributes"],Mi=["tagName","visible","focused","attributes","boundingClientRect","classNames","style","innerText","namespaceURI","id","value","checked","selected","selectedIndex","scrollWidth","scrollHeight","scrollLeft","scrollTop","offsetWidth","offsetHeight","offsetLeft","offsetTop","clientWidth","clientHeight","clientLeft","clientTop"],Pi={textContent:function(t){return t.textContent},childNodeCount:function(t){return t.childNodes.length},hasChildNodes:function(t){return!!Pi.childNodeCount(t)},childElementCount:function(t){var e=t.children;if(e)return e.length;for(var n=0,r=t.childNodes.length,i=0;i<r;i++)1===t.childNodes[i].nodeType&&n++;return n},hasChildElements:function(t){return!!Pi.childElementCount(t)}},Ai=(ki.prototype._initializeProperties=function(t,e,n){for(var r=0;r<e.length;r++){var i=e[r],o=n[i];this[i]=o?o(t):t[i]}},ki);function ki(){}var Fi,Li=(i(Oi,Fi=Ai),Oi);function Oi(t){var e=Fi.call(this)||this;return e._initializeProperties(t,Ri,Pi),e}var Ui,Hi={tagName:function(t){return t.tagName.toLowerCase()},visible:y.positionUtils.isElementVisible,focused:function(t){return y.domUtils.getActiveElement()===t},attributes:function(t){for(var e=t.attributes,n={},r=e.length-1;0<=r;r--)n[e[r].name]=e[r].value;return n},boundingClientRect:function(t){var e=t.getBoundingClientRect();return{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width,height:e.height}},classNames:function(t){var e=t.className;return(e="string"==typeof e.animVal?e.animVal:e).replace(/^\s+|\s+$/g,"").split(/\s+/g)},style:function(t){for(var e={},n=Hl.getComputedStyle(t),r=0;r<n.length;r++){var i=n[r];e[i]=n[i]}return e},innerText:function(t){return t.innerText}},Gi=(i(Bi,Ui=Ai),Bi);function Bi(t){var e=Ui.call(this,t)||this;return e._initializeProperties(t,Ni,Hi),e}var Vi,zi=(i(Xi,Vi=Li),Xi);function Xi(t){var e=Vi.call(this,t)||this;return e._initializeProperties(t,Mi,Hi),e}function ji(t){return t}var qi=Hl.Node;function Yi(t){return new xi({serialize:ji,deserialize:ji}).addTransforms(t)}var Ki=(Ji.prototype.shouldTransform=function(t){return"function"===t},Ji.prototype.toSerializable=function(){return""},Ji.prototype.fromSerializable=function(t){return Di(t.fnCode,t.dependencies)},Ji);function Ji(){this.type="Function"}var $i=(Qi.prototype.shouldTransform=function(t,e){return e instanceof qi},Qi.prototype.toSerializable=function(t){return new Gi(t)},Qi);function Qi(){this.type="Node"}var Zi=(to.prototype._extend=function(t,n){var r=this;o.nativeMethods.objectKeys.call(Hl.Object,this.customDOMProperties).forEach(function(e){try{t[e]=r.customDOMProperties[e](n)}catch(t){throw new _e(r.instantiationCallsiteName,t,e)}})},to.prototype.shouldTransform=function(t,e){return e instanceof qi},to.prototype.toSerializable=function(t){var e=new(1===t.nodeType?zi:Li)(t);return this._extend(e,t),e},to);function to(t){this.type="Node",this.customDOMProperties=t||{}}var eo=(no.prototype.shouldTransform=function(t,e){if(e instanceof qi)throw new Yt(this.instantiationCallsiteName)},no);function no(t){this.type="Node",this.instantiationCallsiteName=t}var ro=(io.prototype.getResult=function(){var e=this;return l.Promise.resolve().then(function(){var t=e.replicator.decode(e.command.args);return e._executeFn(t)}).catch(function(t){throw t.isTestCafeError||(t=new pe(e.command.instantiationCallsiteName,t)),t})},io.prototype.getResultDriverStatus=function(){var e=this;return this.getResult().then(function(t){return new Ti({isCommandResult:!0,result:e.replicator.encode(t)})}).catch(function(t){return new Ti({isCommandResult:!0,executionError:t})})},io.prototype._createReplicator=function(){return Yi([new eo(this.command.instantiationCallsiteName),new Ki])},io.prototype._executeFn=function(t){return this.fn.apply(Hl,t)},io);function io(t){this.command=t,this.replicator=this._createReplicator(),this.dependencies=this.replicator.decode(this.command.dependencies),this.fn=Di(this.command.fnCode,this.dependencies)}var oo="appeared-dialog",so="unexpected-dialog",ao="handler-error",lo=o.eventSandbox.message,co=o.processScript,uo=o.nativeMethods,ho="testcafe|native-dialog-tracker|appeared-dialogs",fo="testcafe|native-dialog-tracker|unexpected-dialog",mo="testcafe|native-dialog-tracker|error-in-handler",po=co("window.location.href"),go=(Object.defineProperty(vo.prototype,"appearedDialogs",{get:function(){var t=this.contextStorage.getItem(ho);return t||(t=[],this.appearedDialogs=t),t},set:function(t){this.contextStorage.setItem(ho,t)},enumerable:!1,configurable:!0}),Object.defineProperty(vo.prototype,"unexpectedDialog",{get:function(){return this.contextStorage.getItem(fo)},set:function(t){this.contextStorage.setItem(fo,t)},enumerable:!1,configurable:!0}),Object.defineProperty(vo.prototype,"handlerError",{get:function(){return this.contextStorage.getItem(mo)},set:function(t){this.contextStorage.setItem(mo,t)},enumerable:!1,configurable:!0}),vo._getPageUrl=function(){return uo.eval(po)},vo.prototype._initListening=function(){var n=this;lo.on(lo.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message;e.type===oo?n._addAppearedDialogs(e.dialogType,e.text,e.url):e.type!==so||n.unexpectedDialog?e.type!==ao||n.handlerError||n._onHandlerError(e.dialogType,e.message,e.url):n.unexpectedDialog={type:e.dialogType,url:e.url}})},vo.prototype._init=function(){var e=this;o.on(o.EVENTS.beforeUnload,function(t){t.prevented&&!t.isFakeIEEvent&&(e.dialogHandler?e._createDialogHandler("beforeunload")(t.returnValue||""):e._defaultDialogHandler("beforeunload")),e.contextStorage&&e.contextStorage.save()}),Hl.alert=function(){return e._defaultDialogHandler("alert")},Hl.confirm=function(){return e._defaultDialogHandler("confirm")},Hl.prompt=function(){return e._defaultDialogHandler("prompt")}},vo.prototype._createDialogHandler=function(i){var o=this;return function(t){var e=vo._getPageUrl();o._addAppearedDialogs(i,t,e);var n=new ro(o.dialogHandler),r=null;try{r=n.fn.apply(Hl,[i,t,e])}catch(t){o._onHandlerError(i,t.message||String(t),e)}return r}},vo.prototype._defaultDialogHandler=function(t){var e=vo._getPageUrl();this.unexpectedDialog=this.unexpectedDialog||{type:t,url:e}},vo.prototype._addAppearedDialogs=function(t,e,n){this.appearedDialogs.splice(0,0,{type:t,text:e,url:n})},vo.prototype._onHandlerError=function(t,e,n){this.handlerError=this.handlerError||{type:t,message:e,url:n}},vo.prototype.setHandler=function(t){var e=this;this.dialogHandler=t,["alert","confirm","prompt"].forEach(function(t){Hl[t]=e.dialogHandler?e._createDialogHandler(t):function(){return e._defaultDialogHandler(t)}})},vo.prototype.getUnexpectedDialogError=function(){var t=this.unexpectedDialog,e=this.handlerError;return this.unexpectedDialog=null,this.handlerError=null,t?new ri(t.type,t.url):e?new ci(e.type,e.message,e.url):null},vo);function vo(t,e){this.contextStorage=t,this.dialogHandler=e,this._init(),this._initListening(),this.dialogHandler&&this.setHandler(e)}function wo(t){this.type=t,this.id=Ii()}var yo,_o="driver|establish-connection",Eo="driver|switch-to-window",Co="driver|close-window",Io="driver|close-window-validation",So="driver|switch-to-window-validation",To="driver|command-executed",bo="driver|execute-command",Wo="driver|confirmation",xo="driver|set-native-dialog-handler",Do="driver|set-as-master",Ro="driver|close-all-child-windows",No=(i(Mo,yo=wo),Mo);function Mo(){return yo.call(this,_o)||this}var Po,Ao=(i(ko,Po=wo),ko);function ko(t){var e=Po.call(this,Io)||this;return e.windowId=t,e}var Fo,Lo=(i(Oo,Fo=wo),Oo);function Oo(t){var e=Fo.call(this,So)||this;return e.windowId=t,e}var Uo,Ho=(i(Go,Uo=wo),Go);function Go(t){var e=Uo.call(this,Co)||this;return e.windowId=t,e}var Bo,Vo=(i(zo,Bo=wo),zo);function zo(t){var e=Bo.call(this,Eo)||this;return e.windowId=t,e}var Xo,jo=(i(qo,Xo=wo),qo);function qo(t){var e=Xo.call(this,To)||this;return e.driverStatus=t,e}var Yo,Ko=(i(Jo,Yo=wo),Jo);function Jo(t,e){var n=Yo.call(this,bo)||this;return n.command=t,n.testSpeed=e,n}var $o,Qo=(i(Zo,$o=wo),Zo);function Zo(t,e){var n=$o.call(this,Wo)||this;return n.requestMessageId=t,n.result=e,n}var ts,es=(i(ns,ts=wo),ns);function ns(t){var e=ts.call(this,xo)||this;return e.dialogHandler=t,e}var rs,is=(i(os,rs=wo),os);function os(){return rs.call(this,Do)||this}var ss,as=(i(ls,ss=wo),ls);function ls(){return ss.call(this,Ro)||this}var cs=o.json,us=o.nativeMethods,ds=(hs.prototype._createStorageKey=function(t,e){var n="testcafe|driver|"+t;return e?n+"|"+e:n},hs.prototype._loadFromStorage=function(){var t=this.storage.getItem(this.storageKey);t&&(this.data=cs.parse(t),this.storage.removeItem(this.storageKey))},hs.prototype.save=function(){this.storage.setItem(this.storageKey,cs.stringify(this.data))},hs.prototype.setItem=function(t,e){this.data[t]=e,this.save()},hs.prototype.getItem=function(t){return this.data[t]},hs.prototype.dispose=function(){this.storage.removeItem(this.storageKey)},hs);function hs(t,e,n){this.storage=us.winSessionStorageGetter.call(t),this.storageKey=this._createStorageKey(e,n),this.data={},this._loadFromStorage()}function fs(n,t,e,r){var i=null,o=null,s=null;return e=Math.max(e||0,2500),l.Promise.race([y.delay(e),new l.Promise(function(e){s=function(t){t.message.type===Wo&&t.message.requestMessageId===n.id&&e(t.message)},l.eventSandbox.message.on(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),i=l.nativeMethods.setInterval.call(Hl,function(){return l.eventSandbox.message.sendServiceMsg(n,t)},1e3),l.eventSandbox.message.sendServiceMsg(n,t)})]).then(function(t){if(l.nativeMethods.clearInterval.call(Hl,i),l.nativeMethods.clearTimeout.call(Hl,o),l.eventSandbox.message.off(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),!t)throw new r;return t})}var ms=2e4;function ps(t){var e=t.requestMsgId,n=t.result,r=t.window,i=new Qo(e,n);l.eventSandbox.message.sendServiceMsg(i,r)}var gs=(Object.defineProperty(vs.prototype,"availabilityTimeout",{set:function(t){this.iframeAvailabilityTimeout=t},enumerable:!1,configurable:!0}),vs.prototype._ensureIframe=function(){var t=this;return y.domUtils.isElementInDocument(this.driverIframe)?y.waitFor(function(){return y.positionUtils.isElementVisible(t.driverIframe)?t.driverIframe:null},200,this.iframeAvailabilityTimeout).catch(function(){throw new ti}):l.Promise.reject(new $r)},vs.prototype._waitForIframeRemovedOrHidden=function(){var e=this;return new l.Promise(function(t){e.checkIframeInterval=l.nativeMethods.setInterval.call(Hl,function(){e._ensureIframe().catch(function(){return y.delay(500).then(function(){return t(new Ti({isCommandResult:!0}))})})},1e3)})},vs.prototype._waitForCommandResult=function(){var e=this,n=null;return l.Promise.race([this._waitForIframeRemovedOrHidden(),new l.Promise(function(e){n=function(t){t.message.type===To&&e(t.message.driverStatus)},l.eventSandbox.message.on(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n)})]).then(function(t){return l.eventSandbox.message.off(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n),l.nativeMethods.clearInterval.call(Hl,e.checkIframeInterval),t})},vs.prototype.sendConfirmationMessage=function(t){ps({requestMsgId:t,result:{id:this.driverId},window:this.driverWindow})},vs.prototype.executeCommand=function(e,n){var r=this;return this._ensureIframe().then(function(){var t=new Ko(e,n);return l.Promise.all([fs(t,r.driverWindow,r.iframeAvailabilityTimeout,Dr),r._waitForCommandResult()])}).then(function(t){return t[1]})},vs);function vs(t,e){this.driverWindow=t,this.driverIframe=y.domUtils.findIframeByWindow(t),this.driverId=e,this.iframeAvailabilityTimeout=0}var ws=o.Promise,ys=o.nativeMethods,_s=(Es.prototype._onScriptElementAdded=function(t){var e,n,r=this,i=ys.scriptSrcGetter.call(t);void 0!==i&&""!==i&&(this.scriptsCount++,e=null,n=function(){ys.removeEventListener.call(t,"load",n),ys.removeEventListener.call(t,"error",n),ys.clearTimeout.call(Hl,e),r._onScriptLoadedOrFailed()},ys.addEventListener.call(t,"load",n),ys.addEventListener.call(t,"error",n),e=ys.setTimeout.call(Hl,n,this.SCRIPT_LOADING_TIMEOUT))},Es.prototype._onScriptLoadedOrFailed=function(){var t=this;this.scriptsCount--,this.scriptsCount||y.delay(25).then(function(){t.resolveWaitingPromise&&(t.scriptsCount||t.resolveWaitingPromise())})},Es.prototype.wait=function(){var n=this;return new ws(function(t){function e(){ys.clearTimeout.call(Hl,n.watchdog),o.off(o.EVENTS.scriptElementAdded,n.scriptElementAddedHandler),n.watchdog=null,n.resolveWaitingPromise=null,t()}n.scriptsCount?(n.watchdog=ys.setTimeout.call(Hl,e,n.BARRIER_TIMEOUT),n.resolveWaitingPromise=e):e()})},Es);function Es(){var e=this;this.watchdog=null,this.SCRIPT_LOADING_TIMEOUT=2e3,this.BARRIER_TIMEOUT=3e3,this.scriptsCount=0,this.resolveWaitingPromise=null,this.scriptElementAddedHandler=function(t){return e._onScriptElementAdded(t.el)},o.on(o.EVENTS.scriptElementAdded,this.scriptElementAddedHandler)}function Cs(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=new y.RequestBarrier,i=new _s;y.pageUnloadBarrier.watchForPageNavigationTriggers();var o=null,s=t.apply(void 0,e),a=s.then(function(t){return o=t,l.Promise.all([r.wait().then(function(){return i.wait()}),y.pageUnloadBarrier.wait()])}).then(function(){return o});return{actionPromise:s,barriersPromise:a}}var Is,Ss=Array.isArray,Ts=Hl.Node,bs=Hl.HTMLCollection,Ws=Hl.NodeList;function xs(t){return!!t}function Ds(t){return!(!y.domUtils.isDomElement(t)&&!y.domUtils.isTextNode(t))&&(y.domUtils.isOptionElement(t)||"optgroup"===y.domUtils.getTagName(t)?n.selectElement.isOptionElementVisible(t):y.positionUtils.isElementVisible(t))}function Rs(t){return t instanceof bs||t instanceof Ws||function(t){if(Ss(t)){for(var e=0;e<t.length;e++)if(!(t[e]instanceof Ts))return;return 1}}(t)}var Ns=e.arrayUtils,Ms=o.utils.types,Ps=o.nativeMethods,As=1,ks=2,Fs=3,Ls=((Is={})[As]=/^\.filterVisible\(\)$/,Is[ks]=/^\.filterHidden\(\)$/,Is[Fs]=/^\.nth\(\d+\)$/,Is),Os=(Object.defineProperty(Us.prototype,"error",{get:function(){return this.err},set:function(t){null===this.err&&(this.err=t)},enumerable:!1,configurable:!0}),Us.prototype.filter=function(t,e,n){var r,i=Ns.filter(t,xs);return e.filterVisible&&(i=i.filter(Ds),this.assertFilterError(i,n,As)),e.filterHidden&&(i=i.filter(function(t){return!Ds(t)}),this.assertFilterError(i,n,ks)),e.counterMode?i=null!==e.index?this.getNodeByIndex(i,e.index)?1:0:i.length:(e.collectionMode?null!==e.index&&(i=(r=this.getNodeByIndex(i,e.index))?[r]:[]):i=this.getNodeByIndex(i,e.index||0),"number"==typeof e.index&&this.assertFilterError(i,n,Fs)),i},Us.prototype.cast=function(t){var e=null;if(Ms.isNullOrUndefined(t))e=[];else if(t instanceof Node)e=[t];else{if(!Rs(t))throw new te;e=t}return e},Us.prototype.assertFilterError=function(t,e,n){t&&0!==t.length||(this.error=this.getErrorItem(e,n))},Us.prototype.getErrorItem=function(t,e){var n=t.apiFnChain,r=t.apiFnID;if(e)for(var i=r;i<n.length;i++)if(Ls[e].test(n[i]))return i;return null},Us.prototype.getNodeByIndex=function(t,e){return e<0?t[t.length+e]:t[e]},Us);function Us(){this.err=null}Ps.objectDefineProperty.call(Hl,Hl,"%testCafeSelectorFilter%",{value:new Os,configurable:!0});var Hs,Gs=(i(Bs,Hs=ro),Bs.prototype._createReplicator=function(){return Yi([new Ki])},Bs.prototype._getTimeoutErrorParams=function(){var t=Hl["%testCafeSelectorFilter%"].error,e=this.command.apiFnChain;return void 0!==t?{apiFnIndex:t,apiFnChain:e}:null},Bs.prototype._getTimeoutError=function(t){return t?this.createIsInvisibleError:this.createNotFoundError},Bs.prototype._validateElement=function(o,s){var a=this;return l.Promise.resolve().then(function(){return a.fn.apply(Hl,o)}).then(function(t){var e=!!t,n=!a.command.visibilityCheck||Ds(t),r=new Date-s>=a.timeout;if(e&&n)return t;if(!r)return y.delay(200).then(function(){return a._validateElement(o,s)});var i=a.getVisibleValueMode?null:a._getTimeoutError(e);if(i)throw i(a._getTimeoutErrorParams());return null})},Bs.prototype._executeFn=function(t){if(this.counterMode)return Hs.prototype._executeFn.call(this,t);var e=new Date,n=null,r=null;return this._validateElement(t,e).catch(function(t){n=t}).then(function(t){if(n)throw n;r=t}).then(function(){return r})},Bs);function Bs(t,e,n,r,i){var o,s=Hs.call(this,t)||this;s.createNotFoundError=r,s.createIsInvisibleError=i,s.timeout="number"==typeof t.timeout?t.timeout:e,s.counterMode=s.dependencies.filterOptions.counterMode,s.getVisibleValueMode=s.dependencies.filterOptions.getVisibleValueMode,n&&(o=new Date-n,s.timeout=Math.max(s.timeout-o,0));var a=s.dependencies&&s.dependencies.customDOMProperties;return s.replicator.addTransforms([new Zi(a)]),s}var Vs=(zs.prototype._ensureElement=function(t){var e=this,n=t.selector,r=t.createNotFoundError,i=t.createIsInvisibleError,o=t.createHasWrongNodeTypeError;this.ensureElementsPromise=this.ensureElementsPromise.then(function(){return new Gs(n,e.globalSelectorTimeout,e.ensureElementsStartTime,r,i).getResult()}).then(function(t){if(!y.domUtils.isDomElement(t))throw o(y.NODE_TYPE_DESCRIPTIONS[t.nodeType]);e.elements.push(t)})},zs.prototype.getElements=function(){var t=this;return this.ensureElementsPromise.then(function(){return t.elements})},zs);function zs(t,e){var n=this;this.elements=[],this.globalSelectorTimeout=e,this.ensureElementsPromise=l.Promise.resolve(),this.ensureElementsStartTime=new Date,t.forEach(function(t){return n._ensureElement(t)})}function Xs(t,e){return new Vs(t,e).getElements()}function js(t){return{selector:t,createNotFoundError:function(t){return new Cn(t)},createIsInvisibleError:function(){return new Tn},createHasWrongNodeTypeError:function(t){return new xn(t)}}}function qs(t,e){return{selector:t,createNotFoundError:function(t){return new Nn(e,t)},createIsInvisibleError:function(){return new An(e)},createHasWrongNodeTypeError:function(t){return new Ln(e,t)}}}function Ys(t,e){if(!y.domUtils.isContentEditableElement(t))throw new jn(e)}var Ks=(Js.prototype._getSpecificTimeout=function(){return this.command.selector&&"number"==typeof this.command.selector.timeout?this.command.selector.timeout:this.globalSelectorTimeout},Js.prototype._delayAfterExecution=function(){return this.command.options&&1!==this.command.options.speed?y.delay(2e3*(1-this.command.options.speed)):l.Promise.resolve()},Js.prototype._isExecutionTimeoutExpired=function(){return Date.now()-this.executionStartTime>=this.commandSelectorTimeout},Js.prototype._ensureCommandArguments=function(){if(this.command.type===u.pressKey&&y.parseKeySequence(this.command.keys).error)throw new Qn("keys")},Js.prototype._ensureCommandElements=function(){var e=this,t=[];return this.command.selector&&t.push(js(this.command.selector)),this.command.type===u.dragToElement?t.push(qs(this.command.destinationSelector,"destinationSelector")):this.command.type===u.selectEditableContent&&(t.push(qs(this.command.startSelector,"startSelector")),t.push(qs(this.command.endSelector||this.command.startSelector,"endSelector"))),Xs(t,this.globalSelectorTimeout).then(function(t){e.elements=t})},Js.prototype._ensureCommandElementsProperties=function(){this.command.type===u.selectText?function(t){if(!y.domUtils.isEditableElement(t))throw new Hn}(this.elements[0]):this.command.type===u.selectTextAreaContent?function(t){if(!y.domUtils.isTextAreaElement(t))throw new Vn}(this.elements[0]):this.command.type===u.selectEditableContent?(Ys(this.elements[0],"startSelector"),Ys(this.elements[1],"endSelector"),function(t){if(!y.contentEditable.getNearestCommonAncestor(t[0],t[1]))throw new Kn}(this.elements)):this.command.type!==u.setFilesToUpload&&this.command.type!==u.clearUpload||function(t){if(!y.domUtils.isFileInput(t))throw new ir}(this.elements[0])},Js.prototype._ensureCommandOptions=function(){var t,e,n,r,i;this.elements.length&&this.command.options&&"offsetX"in this.command.options&&"offsetY"in this.command.options&&(t=this.elements[0],e=this.command.options,n=_.getOffsetOptions(t,e.offsetX,e.offsetY),r=n.offsetX,i=n.offsetY,e.offsetX=r,e.offsetY=i)},Js.prototype._createAutomation=function(){var t;switch(this.command.type){case u.click:return/option|optgroup/.test(y.domUtils.getTagName(this.elements[0]))?new _.SelectChildClick(this.elements[0],this.command.options):new _.Click(this.elements[0],this.command.options);case u.rightClick:return new _.RClick(this.elements[0],this.command.options);case u.doubleClick:return new _.DblClick(this.elements[0],this.command.options);case u.hover:return new _.Hover(this.elements[0],this.command.options);case u.drag:return new _.DragToOffset(this.elements[0],this.command.dragOffsetX,this.command.dragOffsetY,this.command.options);case u.dragToElement:return new _.DragToElement(this.elements[0],this.elements[1],this.command.options);case u.typeText:return new _.Type(this.elements[0],this.command.text,this.command.options);case u.selectText:case u.selectTextAreaContent:return t=_.calculateSelectTextArguments(this.elements[0],this.command),new _.SelectText(this.elements[0],t.startPos,t.endPos,this.command.options);case u.selectEditableContent:return new _.SelectEditableContent(this.elements[0],this.elements[1],this.command.options);case u.pressKey:return new _.Press(y.parseKeySequence(this.command.keys).combinations,this.command.options);case u.setFilesToUpload:return new _.Upload(this.elements[0],this.command.filePath,function(t,e){return new er(t,e)});case u.clearUpload:return new _.Upload(this.elements[0])}return null},Js.prototype._runAction=function(e){var n=this;return this._ensureCommandElements().then(function(){return n._ensureCommandElementsProperties()}).then(function(){n._ensureCommandOptions();var t=n._createAutomation();return t.TARGET_ELEMENT_FOUND_EVENT?t.on(t.TARGET_ELEMENT_FOUND_EVENT,function(t){n.targetElement=t.element,n.statusBar.hideWaitingElementStatus(!0),n.executionStartedHandler()}):(n.statusBar.hideWaitingElementStatus(!0),n.executionStartedHandler()),t.run(e)})},Js.prototype._runRecursively=function(){var e=this,t=!1,n=!0;return y.promiseUtils.whilst(function(){return!t},function(){return e._runAction(n).then(function(){t=!0}).catch(function(t){if(e._isExecutionTimeoutExpired()){if(t.message===_.ERROR_TYPES.foundElementIsNotTarget)return n=!1,l.Promise.resolve();throw t.message===_.ERROR_TYPES.elementIsInvisibleError?new Tn:t}return y.delay(250)})})},Js.prototype.execute=function(){var i=this;return this.command.options&&!this.command.options.speed&&(this.command.options.speed=this.testSpeed),{startPromise:new l.Promise(function(t){i.executionStartedHandler=t}),completionPromise:new l.Promise(function(n){i.executionStartTime=new Date;try{i._ensureCommandArguments()}catch(t){return void n(new Ti({isCommandResult:!0,executionError:t}))}i.commandSelectorTimeout=i._getSpecificTimeout(),i.statusBar.showWaitingElementStatus(i.commandSelectorTimeout);var t=Cs(function(){return i._runRecursively()}),e=t.actionPromise,r=t.barriersPromise;e.then(function(){return l.Promise.all([i._delayAfterExecution(),r])}).then(function(){var t={isCommandResult:!0},e=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(i.elements);i.targetElement&&(e[0]=i.targetElement),t.result=Yi(new $i).encode(e),n(new Ti(t))}).catch(function(t){return i.statusBar.hideWaitingElementStatus(!1).then(function(){return n(new Ti({isCommandResult:!0,executionError:t}))})})})}},Js);function Js(t,e,n,r){this.command=t,this.globalSelectorTimeout=e,this.statusBar=n,this.testSpeed=r,this.targetElement=null,this.elements=[],this.ensureElementsPromise=null,this.ensureElementsStartTime=null,this.executionStartTime=null,this.executionStartedHandler=null,this.commandSelectorTimeout=null}function $s(t,e,n){return Math.min(Math.max(e,t),n)}function Qs(t,e){var n="number"==typeof t.min,r="number"==typeof t.max,i="number"==typeof t.length;return i&&(t.length=$s(t.length,0,e)),n&&t.min<0&&(t.min+=e),r&&t.max<0&&(t.max+=e),n||(t.min=r&&i?t.max-t.length:0),r||(t.max=i?t.min+t.length:e),t.min=$s(t.min,0,e),t.max=$s(t.max,0,e),t.length=t.max-t.min,t}function Zs(t,e,n){return Math.round(t+$s(e-t,0,n)/2)}function ta(r){return function(t,e){var n=typeof e;if("number"!=n)throw new r(t,n);if(isNaN(e)||!isFinite(e)||e!==Math.floor(e))throw new r(t,e)}}var ea,na,ra,ia,oa,sa=ta(Ue),aa=(na=ta(ea=Be),function(t,e){if(na(t,e),e<0)throw new ea(t,e)}),la=(ra=je,function(t,e){var n=typeof e;if("boolean"!=n)throw new ra(t,n)}),ca=(ia=ln,function(t,e){var n=typeof e;if("number"!=n)throw new ia(t,n);if(isNaN(e)||e<.01||1<e)throw new ia(t,e)}),ua=(i(da,oa=Ei),da.prototype._getAssignableProperties=function(){return[{name:"speed",type:ca}]},da);function da(t,e){var n=oa.call(this)||this;return n.speed=null,n._assignFrom(t,e),n}var ha,fa=(i(ma,ha=ua),ma.prototype._getAssignableProperties=function(){return ha.prototype._getAssignableProperties.call(this).concat([{name:"offsetX",type:sa},{name:"offsetY",type:sa}])},ma);function ma(t,e){var n=ha.call(this)||this;return n.offsetX=null,n.offsetY=null,n._assignFrom(t,e),n}var pa,ga=(i(va,pa=fa),va.prototype._getAssignableProperties=function(){return pa.prototype._getAssignableProperties.call(this).concat([{name:"scrollToCenter",type:la},{name:"skipParentFrames",type:la}])},va);function va(t,e){var n=pa.call(this)||this;return n.scrollToCenter=!1,n.skipParentFrames=!1,n._assignFrom(t,e),n}var wa,ya=(i(_a,wa=ua),_a.prototype._getAssignableProperties=function(){return wa.prototype._getAssignableProperties.call(this).concat([{name:"scrollTargetX",type:sa},{name:"scrollTargetY",type:sa},{name:"crop.left",type:sa},{name:"crop.right",type:sa},{name:"crop.top",type:sa},{name:"crop.bottom",type:sa},{name:"includeMargins",type:la},{name:"includeBorders",type:la},{name:"includePaddings",type:la}])},_a);function _a(t,e){var n=wa.call(this)||this;return n.scrollTargetX=null,n.scrollTargetY=null,n.includeMargins=!1,n.includeBorders=!0,n.includePaddings=!0,n.crop={left:null,right:null,top:null,bottom:null},n._assignFrom(t,e),n}var Ea,Ca=(i(Ia,Ea=fa),Ia.prototype._getAssignableProperties=function(){return Ea.prototype._getAssignableProperties.call(this).concat([{name:"modifiers.ctrl",type:la},{name:"modifiers.alt",type:la},{name:"modifiers.shift",type:la},{name:"modifiers.meta",type:la}])},Ia);function Ia(t,e){var n=Ea.call(this)||this;return n.modifiers={ctrl:!1,alt:!1,shift:!1,meta:!1},n._assignFrom(t,e),n}var Sa,Ta,ba,Wa,xa,Da,Ra=(i(Na,Sa=Ca),Na.prototype._getAssignableProperties=function(){return Sa.prototype._getAssignableProperties.call(this).concat([{name:"caretPos",type:aa}])},Na);function Na(t,e){var n=Sa.call(this)||this;return n.caretPos=null,n._assignFrom(t,e),n}function Ma(t,e){var n=Ta.call(this)||this;return n.speed=null,n.minMovingTime=null,n.holdLeftButton=!1,n.skipScrolling=!1,n.skipDefaultDragBehavior=!1,n._assignFrom(t,e),n}function Pa(t,e){var n=ba.call(this)||this;return n.replace=!1,n.paste=!1,n._assignFrom(t,e),n}function Aa(t,e){var n=Wa.call(this,t,e)||this;return n.destinationOffsetX=null,n.destinationOffsetY=null,n._assignFrom(t,e),n}function ka(t,e){var n=xa.call(this)||this;return n.portraitOrientation=!1,n._assignFrom(t,e),n}function Fa(t,e){var n=Da.call(this)||this;return n.timeout=void 0,n.allowUnawaitedPromise=!1,n._assignFrom(t,e),n}i(Ma,Ta=Ca),Ma.prototype._getAssignableProperties=function(){return Ta.prototype._getAssignableProperties.call(this).concat([{name:"speed"},{name:"minMovingTime"},{name:"holdLeftButton"},{name:"skipScrolling",type:la},{name:"skipDefaultDragBehavior",type:la}])},i(Pa,ba=Ra),Pa.prototype._getAssignableProperties=function(){return ba.prototype._getAssignableProperties.call(this).concat([{name:"replace",type:la},{name:"paste",type:la}])},i(Aa,Wa=Ca),Aa.prototype._getAssignableProperties=function(){return Wa.prototype._getAssignableProperties.call(this).concat([{name:"destinationOffsetX",type:sa},{name:"destinationOffsetY",type:sa}])},i(ka,xa=Ei),ka.prototype._getAssignableProperties=function(){return[{name:"portraitOrientation",type:la}]},i(Fa,Da=Ei),Fa.prototype._getAssignableProperties=function(){return[{name:"timeout",type:aa},{name:"allowUnawaitedPromise",type:la}]};var La=l.eventSandbox.message,Oa="driver|browser-manipulation|request",Ua="driver|browser-manipulation|response";La.on(La.SERVICE_MSG_RECEIVED_EVENT,function(e){var t,n,r,i,o;e.message.cmd===Oa&&(t=y.domUtils.findIframeByWindow(e.source),r=(n=e.message).command,(i=n.cropDimensions)&&(r.options=new ya({crop:i,includePaddings:!1})),(o=new Ha(r)).element=t,o.execute().then(function(t){return La.sendServiceMsg({cmd:Ua,result:t},e.source)}))});var Ha=(Ga.prototype._getAbsoluteCropValues=function(){var t=this.element.getBoundingClientRect(),e=t.top,n=t.left;n+=this.command.options.originOffset.x,e+=this.command.options.originOffset.y;var r=n+this.command.options.crop.right,i=e+this.command.options.crop.bottom;return{top:e+=this.command.options.crop.top,left:n+=this.command.options.crop.left,bottom:i,right:r}},Ga.prototype._createManipulationReadyMessage=function(){var t=Hl.devicePixelRatio||1,e={cmd:c,pageDimensions:{dpr:t,innerWidth:Hl.innerWidth,innerHeight:Hl.innerHeight,documentWidth:Gl.documentElement.clientWidth,documentHeight:Gl.documentElement.clientHeight,bodyWidth:Gl.body.clientWidth,bodyHeight:Gl.body.clientHeight},disableResending:!0};return this.command.type===u.takeElementScreenshot&&(e.cropDimensions=this._getAbsoluteCropValues()),e},Ga.prototype._runScrollBeforeScreenshot=function(){var i=this;return l.Promise.resolve().then(function(){if(i.element||!i.command.selector)return l.Promise.resolve();var t=i.command.selector.timeout,e="number"==typeof t?t:i.globalSelectorTimeout;return i.statusBar.showWaitingElementStatus(e),Xs([js(i.command.selector)],i.globalSelectorTimeout).then(function(t){i.statusBar.hideWaitingElementStatus(),i.element=t[0]}).catch(function(t){throw i.statusBar.hideWaitingElementStatus(),t})}).then(function(){!function(t,e){var n=t.getBoundingClientRect(),r={left:n.left,right:n.right,top:n.top,bottom:n.bottom},i=y.styleUtils.getElementMargin(t),o=y.styleUtils.getElementPadding(t),s=y.styleUtils.getBordersWidth(t);e.originOffset={x:0,y:0};var a=r.left+t.scrollWidth+s.left+s.right,l=r.top+t.scrollHeight+s.top+s.bottom;r.right=Math.max(r.right,a),r.bottom=Math.max(r.bottom,l),e.includeBorders&&e.includePaddings?e.includeMargins&&(e.originOffset.x-=i.left,e.originOffset.y-=i.top,r.left-=i.left,r.top-=i.top,r.right+=i.right,r.bottom+=i.bottom):(e.originOffset.x+=s.left,e.originOffset.y+=s.top,r.left+=s.left,r.top+=s.top,r.right-=s.right,r.bottom-=s.bottom,e.includePaddings||(e.originOffset.x+=o.left,e.originOffset.y+=o.top,r.left+=o.left,r.top+=o.top,r.right-=o.right,r.bottom-=o.bottom)),r.width=r.right-r.left,r.height=r.bottom-r.top;var c=Qs({min:e.crop.left,max:e.crop.right,length:e.crop.width},r.width),u=Qs({min:e.crop.top,max:e.crop.bottom,length:e.crop.height},r.height);if(e.crop.left=c.min,e.crop.right=c.max,e.crop.width=c.length,e.crop.top=u.min,e.crop.bottom=u.max,e.crop.height=u.length,e.crop.width<=0||e.crop.height<=0)throw new wr(e.crop.width,e.crop.height);var d=y.styleUtils.getViewportDimensions();(r.width>d.width||r.height>d.height)&&(e.scrollToCenter=!0);var h="number"==typeof e.scrollTargetX,f="number"==typeof e.scrollTargetY;h||(e.scrollTargetX=Zs(e.crop.left,e.crop.right,d.width)),f||(e.scrollTargetY=Zs(e.crop.top,e.crop.bottom,d.height));var m=_.getOffsetOptions(t,e.scrollTargetX,e.scrollTargetY),p=m.offsetX,g=m.offsetY;e.scrollTargetX=p,e.scrollTargetY=g;var v=!h||e.scrollTargetX>=e.crop.left&&e.scrollTargetX<=e.crop.right,w=!f||e.scrollTargetY>=e.crop.top&&e.scrollTargetY<=e.crop.bottom;if(!v||!w)throw new ur(v,w)}(i.element,i.command.options);var t=i.command.options,e=t.scrollTargetX,n=t.scrollTargetY,r=t.scrollToCenter;return new _.Scroll(i.element,new ga({offsetX:e,offsetY:n,scrollToCenter:r,skipParentFrames:!0})).run()})},Ga.prototype._hideUI=function(){return n.hide(),this.command.markData&&n.showScreenshotMark(this.command.markData),y.delay(500)},Ga.prototype._showUI=function(){this.command.markData&&n.hideScreenshotMark(),n.show()},Ga.prototype._requestManipulation=function(){if(Hl.top===Hl)return l.transport.queuedAsyncServiceMsg(this._createManipulationReadyMessage());var t=this._getAbsoluteCropValues();return y.sendRequestToFrame({cmd:Oa,command:this.command,cropDimensions:t},Ua,Hl.parent).then(function(t){if(!t.result)return{result:null};var e=t.result,n=e.result,r=e.executionError;if(r)throw r;return{result:n}})},Ga.prototype._runManipulation=function(){var r=this,i=null;return l.Promise.resolve().then(function(){return r.command.type!==u.takeElementScreenshot?l.Promise.resolve():(y.scrollController.stopPropagation(),r._runScrollBeforeScreenshot())}).then(function(){return Hl.top===Hl?r._hideUI():l.Promise.resolve()}).then(function(){return r._requestManipulation()}).then(function(t){var e=t.result,n=t.error;if(n)throw n;return y.scrollController.enablePropagation(),i=e,Hl.top===Hl&&r._showUI(),y.delay(200)}).then(function(){return new Ti({isCommandResult:!0,result:i})}).catch(function(t){return y.scrollController.enablePropagation(),new Ti({isCommandResult:!0,executionError:t})})},Ga.prototype.execute=function(){var t=this;return Cs(function(){return t._runManipulation()}).barriersPromise},Ga);function Ga(t,e,n){this.command=t,this.globalSelectorTimeout=e,this.statusBar=n,this.element=null}var Ba=o.createNativeXHR,Va=o.utils,za=o.Promise,Xa=(ja.prototype.setAsMaster=function(){return fs(new is,this.driverWindow,ms,Or)},ja.prototype.closeAllChildWindows=function(){return fs(new as,this.driverWindow,ms,Gr)},ja.prototype.findChildWindows=function(t,e){return fs(new e(t.windowId),this.driverWindow,ms,Or)},ja);function ja(t,e){this.driverWindow=t,this.windowId=e}var qa=(Ya.prototype._getTopOpenedWindow=function(t){for(var e=t;e.opener;)e=e.opener;return e},Ya.prototype._setAsMaster=function(t){return fs(new is,t,ms,Or)},Ya.prototype.getTopOpenedWindow=function(){return this._getTopOpenedWindow(this.currentDriverWindow)},Ya.prototype.setTopOpenedWindowAsMaster=function(){var t=this._getTopOpenedWindow(this.currentDriverWindow);return this._setAsMaster(t)},Ya.prototype.setParentWindowAsMaster=function(){var t=this.currentDriverWindow.opener;return this._setAsMaster(t)},Ya);function Ya(t){this.currentDriverWindow=t}var Ka,Ja="master",$a="replica",Qa=o.get("./settings"),Za=o.transport,tl=o.Promise,el=o.eventSandbox.message,nl=o.storages,rl=o.nativeMethods,il=rl.date,ol="testcafe|driver|test-done-sent-flag",sl="testcafe|driver|pending-status",al="testcafe|driver|executing-client-function-descriptor",ll="testcafe|driver|selector-execution-start-time",cl="testcafe|driver|pending-page-error",ul="testcafe|driver|active-iframe-selector",dl="testcafe|driver|test-speed",hl="testcafe|driver|assertion-retries-timeout",fl="testcafe|driver|assertion-retries-start-time",ml="testcafe|driver|console-messages",pl={NotLoadedError:br,NotFoundError:Cn,IsInvisibleError:Tn},gl={NotLoadedError:Dr,NotFoundError:$r,IsInvisibleError:ti},vl=Math.pow(2,31)-1,wl="status-with-command-result-event",yl="empty-command-event",_l="child-window-closed",El=(i(Cl,Ka=y.serviceUtils.EventEmitter),Object.defineProperty(Cl.prototype,"speed",{get:function(){return this.contextStorage.getItem(dl)},set:function(t){this.contextStorage.setItem(dl,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Cl.prototype,"consoleMessages",{get:function(){return new yi(this.contextStorage.getItem(ml))},set:function(t){return this.contextStorage.setItem(ml,t?t.getCopy():null)},enumerable:!1,configurable:!0}),Cl.prototype._hasPendingActionFlags=function(t){return t.getItem(this.COMMAND_EXECUTING_FLAG)||t.getItem(this.EXECUTING_IN_IFRAME_FLAG)},Cl.prototype._getCurrentWindowId=function(){var t=Hl.location.toString(),e=o.utils.url.parseProxyUrl(t);return e&&e.windowId||null},Cl.prototype._onJsError=function(t){if(this.skipJsErrors||this.contextStorage.getItem(ol))return tl.resolve();var e=new ue(t.stack,t.pageUrl);return this.contextStorage.getItem(cl)||this.contextStorage.setItem(cl,e),null},Cl.prototype._unlockPageAfterTestIsDone=function(){return y.disableRealEventsPreventing(),tl.resolve()},Cl.prototype._failIfClientCodeExecutionIsInterrupted=function(){var t=this.contextStorage.getItem(al);return!!t&&(this._onReady(new Ti({isCommandResult:!0,executionError:new Xt(t.instantiationCallsiteName)})),!0)},Cl.prototype.onCustomClientScriptError=function(t,e){var n=e?new Me(t,e):new Te(t);this.contextStorage.getItem(cl)||this.contextStorage.setItem(cl,n)},Cl.prototype._addChildWindowDriverLink=function(t){var e=new Xa(t.window,t.windowId);this.childWindowDriverLinks.push(e),this._ensureClosedChildWindowWatcher()},Cl.prototype._ensureClosedChildWindowWatcher=function(){var e=this;this.checkClosedChildWindowIntervalId||(this.checkClosedChildWindowIntervalId=rl.setInterval.call(Hl,function(){var t=y.arrayUtils.find(e.childWindowDriverLinks,function(t){return t.driverWindow.closed});t&&(e.emit(_l),y.arrayUtils.remove(e.childWindowDriverLinks,t),e._setCurrentWindowAsMaster(),e.childWindowDriverLinks.length||rl.clearInterval.call(Hl,e.checkClosedChildWindowIntervalId))},200))},Cl.prototype._setAsMasterInProgressOrCompleted=function(){return this.setAsMasterInProgress||this.role===Ja},Cl.prototype._setCurrentWindowAsMaster=function(){var t=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,tl.resolve().then(function(){return y.browser.setActiveWindowId(t.browserActiveWindowId,o.createNativeXHR,t.windowId)}).then(function(){t._startInternal({finalizePendingCommand:!0,isFirstRequestAfterWindowSwitching:!0}),t.setAsMasterInProgress=!1}).catch(function(){t._onReady(new Ti({isCommandResult:!0,executionError:new Or}))}))},Cl.prototype._onChildWindowOpened=function(t){this._addChildWindowDriverLink(t),this._switchToChildWindow(t.windowId),this._openWindowPromiseResolveFn(t.windowId)},Cl.prototype._onFormSubmit=function(t){this.contextStorage&&this.contextStorage.getItem(ol)&&(t.preventSubmit=!0)},Cl.prototype._onConsoleMessage=function(t){var e=t.meth,n=t.line,r=this.consoleMessages;r.addMessage(e,n,this.windowId),this.consoleMessages=r},Cl.prototype._addPendingErrorToStatus=function(t){var e=this.contextStorage.getItem(cl);e&&(this.contextStorage.setItem(cl,null),t.pageError=e)},Cl.prototype._addUnexpectedDialogErrorToStatus=function(t){var e=this.nativeDialogsTracker.getUnexpectedDialogError();t.pageError=t.pageError||e},Cl.prototype._addConsoleMessagesToStatus=function(t){t.consoleMessages=this.consoleMessages,this.consoleMessages=null},Cl.prototype._addPendingWindowSwitchingStateToStatus=function(t){t.isPendingWindowSwitching=!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},Cl.prototype._sendStatusRequest=function(t){function e(){return y.getTimeLimitedPromise(Za.asyncServiceMsg(r),5e3)}function n(){return y.delay(300).then(e)}for(var r={cmd:a,status:t,disableResending:!0,allowRejecting:!0},i=e(),o=0;o<s;o++)i=i.catch(n);return i},Cl.prototype._sendStatus=function(t){var e=this;t.resent||(this._addPendingErrorToStatus(t),this._addUnexpectedDialogErrorToStatus(t),this._addConsoleMessagesToStatus(t),this._addPendingWindowSwitchingStateToStatus(t)),this.contextStorage.setItem(sl,t);var n=null;return y.pageUnloadBarrier.wait(0).then(function(){return e._sendStatusRequest(t)}).then(function(t){return n=t,y.pageUnloadBarrier.wait(0)}).then(function(){return e.contextStorage.setItem(sl,null),n})},Cl.prototype._addChildIframeDriverLink=function(t,e){var n,r=this._getChildIframeDriverLinkByWindow(e);r||(n=this.testRunId+"-"+Ii(),r=new gs(e,n),this.childIframeDriverLinks.push(r)),r.sendConfirmationMessage(t)},Cl.prototype._getTargetWindowNotFoundResult=function(){return tl.resolve({success:!1,errCode:Rt})},Cl.prototype._getChildWindowValidateResult=function(t){var e=t.find(function(t){return t.result.success});if(e)return e.result;var n=t.find(function(t){return t.result.errCode===Dt});return(n=n||t.find(function(t){return!!t.result.errCode}))?{errCode:n.result.errCode}:void 0},Cl.prototype._handleWindowValidation=function(e,n,t,r){return this._validateWindow(e,n,t,r).then(function(t){ps({requestMsgId:e.id,window:n,result:t})})},Cl.prototype._validateWindow=function(e,t,n,r){var i=this;if(e.windowId===this.windowId)return n();if(!this.childWindowDriverLinks.length)return tl.resolve({success:!1,errCode:Rt});var o=this.childWindowDriverLinks.map(function(t){return t.findChildWindows(e,r)});return tl.all(o).then(function(t){return i._getChildWindowValidateResult(t)})},Cl.prototype._getCloseWindowFoundResult=function(){return this.childWindowDriverLinks.length?tl.resolve({success:!1,errCode:Dt}):tl.resolve({success:!0})},Cl.prototype._handleCloseWindowValidation=function(t,e){var n=this;return this._handleWindowValidation(t,e,function(){return n._getCloseWindowFoundResult()},Ao)},Cl.prototype._handleSwitchToWindowValidation=function(t,e){return this._handleWindowValidation(t,e,function(){return tl.resolve({success:!0})},Lo)},Cl.prototype._handleCloseWindow=function(t,e){return this._closeWindow(t,e).then(function(){ps({requestMsgId:t.id,window:e})})},Cl.prototype._closeWindow=function(e){if(!this.childWindowDriverLinks.length)return tl.resolve();var t=this.childWindowDriverLinks.find(function(t){return t.windowId===e.windowId});if(t){var n=this._createWaitForEventPromise(_l,2e3);return t.driverWindow.close(),n}var r=this.childWindowDriverLinks.map(function(t){return t.findChildWindows(e,Ho)});return tl.all(r)},Cl.prototype._handleSwitchToWindow=function(t,e){return this._switchToWindow(t).then(function(){ps({requestMsgId:t.id,window:e})})},Cl.prototype._switchToWindow=function(e){var t=this;return e.windowId===this.windowId?tl.resolve().then(function(){t._setCurrentWindowAsMaster()}):this.childWindowDriverLinks.length?tl.all(this.childWindowDriverLinks.map(function(t){return t.findChildWindows(e,Vo)})):tl.resolve()},Cl.prototype._handleSetAsMasterMessage=function(t,e){var n=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,ps({requestMsgId:t.id,window:e}),tl.resolve().then(function(){return y.browser.setActiveWindowId(n.browserActiveWindowId,o.createNativeXHR,n.windowId)}).then(function(){n._startInternal(),n.setAsMasterInProgress=!1}).catch(function(){n._onReady(new Ti({isCommandResult:!0,executionError:new Or}))}))},Cl.prototype._handleCloseAllWindowsMessage=function(t,e){var n=this;this._closeAllChildWindows().then(function(){ps({requestMsgId:t.id,window:e})}).catch(function(){n._onReady(new Ti({isCommandResult:!0,executionError:new Gr}))})},Cl.prototype._initChildDriverListening=function(){var r=this;el.on(el.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message,n=t.source;e.type===_o?r._addChildIframeDriverLink(e.id,n):e.type===Do?r._handleSetAsMasterMessage(e,n):e.type===Eo?r._handleSwitchToWindow(e,n):e.type===Co?r._handleCloseWindow(e,n):e.type===So?r._handleSwitchToWindowValidation(e,n):e.type===Io?r._handleCloseWindowValidation(e,n):e.type===Ro&&r._handleCloseAllWindowsMessage(e,n)})},Cl.prototype._getChildIframeDriverLinkByWindow=function(e){return y.arrayUtils.find(this.childIframeDriverLinks,function(t){return t.driverWindow===e})},Cl.prototype._getChildWindowDriverLinkByWindow=function(e){return y.arrayUtils.find(this.childWindowDriverLinks,function(t){return t.driverWindow===e})},Cl.prototype._runInActiveIframe=function(t){var e=this,n=tl.resolve(),r=this.contextStorage.getItem(ul);!this.activeChildIframeDriverLink&&r&&(n=this._switchToIframe(r,gl)),n.then(function(){return e.contextStorage.setItem(e.EXECUTING_IN_IFRAME_FLAG,!0),e.activeChildIframeDriverLink.executeCommand(t,e.speed)}).then(function(t){return e._onCommandExecutedInIframe(t)}).catch(function(t){return e._onCommandExecutedInIframe(new Ti({isCommandResult:!0,executionError:t}))})},Cl.prototype._onCommandExecutedInIframe=function(t){this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this._onReady(t)},Cl.prototype._ensureChildIframeDriverLink=function(t,e,n){var r=this;return y.waitFor(function(){return r._getChildIframeDriverLinkByWindow(t)},500,n).catch(function(){throw new e})},Cl.prototype._ensureChildWindowDriverLink=function(t,e,n){var r=this;return y.waitFor(function(){return r._getChildWindowDriverLinkByWindow(t)},500,n).catch(function(){throw new e})},Cl.prototype._switchToIframe=function(e,n){var t,r,i,o,s,a,l,c=this,u="number"==typeof e.timeout?e.timeout:this.selectorTimeout;return t=e,r=u,i=null,o=function(t){return new n.NotFoundError(t)},s=function(){return new n.IsInvisibleError},a=this.statusBar,l=new Gs(t,r,i,o,s),a.showWaitingElementStatus(l.timeout),l.getResult().then(function(t){return a.hideWaitingElementStatus(!!t).then(function(){return t})}).catch(function(t){return a.hideWaitingElementStatus(!1).then(function(){throw t})}).then(function(t){if(!y.domUtils.isIframeElement(t))throw new Ir;return c._ensureChildIframeDriverLink(rl.contentWindowGetter.call(t),n.NotLoadedError,u)}).then(function(t){t.availabilityTimeout=u,c.activeChildIframeDriverLink=t,c.contextStorage.setItem(ul,e)})},Cl.prototype._createWaitForEventPromise=function(e,n){var r=this,i=null,t=new tl(function(t){rl.setTimeout.call(Hl,function(){r.off(e,i),t()},n)}),o=new tl(function(t){i=function(){this.off(e,i),t()},r.on(e,i)});return tl.race([t,o])},Cl.prototype._waitForCurrentCommandCompletion=function(){return this.contextStorage.getItem(this.COMMAND_EXECUTING_FLAG)?this._createWaitForEventPromise(wl,vl):tl.resolve()},Cl.prototype._waitForEmptyCommand=function(){return this._createWaitForEventPromise(yl,3e4)},Cl.prototype._abortSwitchingToChildWindowIfItClosed=function(){if(this.activeChildWindowDriverLink.driverWindow.closed)throw y.arrayUtils.remove(this.childWindowDriverLinks,this.activeChildWindowDriverLink),this.activeChildWindowDriverLink=null,new gi},Cl.prototype._switchToChildWindow=function(t){var e=this;return this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0),function(e,t){if("string"!=typeof e)return za.resolve(null);var n=y.arrayUtils.find(t,function(t){return t.windowId===e});if(n)return za.resolve(n);var r=new Mr;return za.reject(r)}(t,this.childWindowDriverLinks).then(function(t){return e._ensureChildWindowDriverLink(t.driverWindow,kr,e.childWindowReadyTimeout)}).then(function(t){return e.activeChildWindowDriverLink=t,e._waitForCurrentCommandCompletion()}).then(function(){return e._waitForEmptyCommand()}).then(function(){return e._abortSwitchingToChildWindowIfItClosed(),e._stopInternal(),e.activeChildWindowDriverLink.setAsMaster()}).then(function(){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(t){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1),t instanceof gi?e._onReady(new Ti):e._onReady(new Ti({isCommandResult:!0,executionError:new Or}))})},Cl.prototype._switchToTopParentWindow=function(){var t=this.parentWindowDriverLink.setTopOpenedWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(t)},Cl.prototype._switchToParentWindow=function(){var t=this.parentWindowDriverLink.setParentWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(t)},Cl.prototype._switchToParentWindowInternal=function(t){var e=this;return this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0),tl.resolve().then(function(){return e._stopInternal(),t()}).then(function(){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1),e._onReady(new Ti({isCommandResult:!0,executionError:new Or}))})},Cl.prototype._switchToMainWindow=function(t){this.activeChildIframeDriverLink&&this.activeChildIframeDriverLink.executeCommand(t),this.contextStorage.setItem(ul,null),this.activeChildIframeDriverLink=null},Cl.prototype._setNativeDialogHandlerInIframes=function(t){for(var e=new es(t),n=0;n<this.childIframeDriverLinks.length;n++)el.sendServiceMsg(e,this.childIframeDriverLinks[n].driverWindow)},Cl.prototype._onActionCommand=function(t){var e,n,r,i,o=this,s=(e=t,n=this.selectorTimeout,r=this.statusBar,i=this.speed,new Ks(e,n,r,i).execute()),a=s.startPromise,l=s.completionPromise;a.then(function(){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!0)}),l.then(function(t){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!1),o._onReady(t)})},Cl.prototype._onSetNativeDialogHandlerCommand=function(t){this.nativeDialogsTracker.setHandler(t.dialogHandler),this._setNativeDialogHandlerInIframes(t.dialogHandler),this._onReady(new Ti({isCommandResult:!0}))},Cl.prototype._onGetNativeDialogHistoryCommand=function(){this._onReady(new Ti({isCommandResult:!0,result:this.nativeDialogsTracker.appearedDialogs}))},Cl.prototype._onGetBrowserConsoleMessagesCommand=function(){this._onReady(new Ti({isCommandResult:!0}))},Cl.prototype._onNavigateToCommand=function(t){var e,n,r,i=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),e=t,n=Va.url.getNavigationUrl(e.url,Hl),r=o.Promise.resolve(),n&&y.browser.isRetryingTestPagesEnabled()&&(r=y.browser.fetchPageToCache(n,Ba)),r.then(function(){var t=new y.RequestBarrier;return o.navigateTo(e.url,e.forceReload),o.Promise.all([t.wait(),y.pageUnloadBarrier.wait()])}).then(function(){return new Ti({isCommandResult:!0})}).catch(function(t){return new Ti({isCommandResult:!0,executionError:t})}).then(function(t){return i.contextStorage.setItem(i.COMMAND_EXECUTING_FLAG,!1),i._onReady(t)})},Cl.prototype._onExecuteClientFunctionCommand=function(t){var e=this;this.contextStorage.setItem(al,{instantiationCallsiteName:t.instantiationCallsiteName}),new ro(t).getResultDriverStatus().then(function(t){e.contextStorage.setItem(al,null),e._onReady(t)})},Cl.prototype._onExecuteSelectorCommand=function(t){var e,n,r,i,o,s,a,l=this,c=this.contextStorage.getItem(ll)||new il,u=t.needError?function(t){return new ie(null,t)}:null;e=t,n=this.selectorTimeout,r=c,o=i=u,s=this.statusBar,a=new Gs(e,n,r,i,o),s.showWaitingElementStatus(a.timeout),a.getResultDriverStatus().then(function(t){return s.hideWaitingElementStatus(!!t.result).then(function(){return t})}).then(function(t){l.contextStorage.setItem(ll,null),l._onReady(t)})},Cl.prototype._onSwitchToMainWindowCommand=function(t){this._switchToMainWindow(t),this._onReady(new Ti({isCommandResult:!0}))},Cl.prototype._onSwitchToIframeCommand=function(t){var e=this;this._switchToIframe(t.selector,pl).then(function(){return e._onReady(new Ti({isCommandResult:!0}))}).catch(function(t){return e._onReady(new Ti({isCommandResult:!0,executionError:t}))})},Cl.prototype._onWindowOpenCommand=function(e){var n=this;return new tl(function(t){n._openWindowPromiseResolveFn=t,Hl.open(e.url)}).then(function(t){n._onReady(new Ti({isCommandResult:!0,result:{id:t}}))})},Cl.prototype._onWindowCloseCommand=function(e){var t,n=this,r=(null===(t=this.parentWindowDriverLink)||void 0===t?void 0:t.getTopOpenedWindow())||Hl,i=!!this.childWindowDriverLinks.find(function(t){return t.windowId===e.windowId}),o=e.windowId||this.windowId;this._validateChildWindowCloseCommandExists(o,r).then(function(t){var e=t.result;if(e&&e.errCode)throw new jr(e.errCode);return fs(new Ho(o),r,ms,Or)}).then(function(){i&&n._onReady(new Ti({isCommandResult:!0}))}).catch(function(t){n._onReady(new Ti({isCommandResult:!0,executionError:t}))})},Cl.prototype._onGetCurrentWindowCommand=function(){this._onReady(new Ti({isCommandResult:!0,result:{id:this.windowId}}))},Cl.prototype._validateChildWindowCloseCommandExists=function(t,e){return fs(new Ao(t),e,ms,Or)},Cl.prototype._validateChildWindowSwitchToWindowCommandExists=function(t,e){return fs(new Lo(t),e,ms,Or)},Cl.prototype._onSwitchToWindow=function(n){var r=this,i=this.parentWindowDriverLink?this.parentWindowDriverLink.getTopOpenedWindow():Hl;this._validateChildWindowSwitchToWindowCommandExists(n.windowId,i).then(function(t){var e=t.result;e&&e.errCode?r._onReady(new Ti({isCommandResult:!0,executionError:new jr(e.errCode)})):(r._stopInternal(),fs(new Vo(n.windowId),i,ms,Or))})},Cl.prototype._onBrowserManipulationCommand=function(t){var e,n,r,i=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),e=t,n=this.selectorTimeout,r=this.statusBar,new Ha(e,n,r).execute().then(function(t){return i.contextStorage.setItem(i.COMMAND_EXECUTING_FLAG,!1),i._onReady(t)})},Cl.prototype._onSetBreakpointCommand=function(t){var e=this;this.statusBar.showDebuggingStatus(t).then(function(t){return e._onReady(new Ti({isCommandResult:!0,result:t}))})},Cl.prototype._onSetTestSpeedCommand=function(t){this.speed=t.speed,this._onReady(new Ti({isCommandResult:!0}))},Cl.prototype._onShowAssertionRetriesStatusCommand=function(t){this.contextStorage.setItem(hl,t.timeout),this.contextStorage.setItem(fl,Date.now()),this.statusBar.showWaitingAssertionRetriesStatus(t.timeout),this._onReady(new Ti({isCommandResult:!0}))},Cl.prototype._onHideAssertionRetriesStatusCommand=function(t){var e=this;this.contextStorage.setItem(hl,null),this.contextStorage.setItem(fl,null),this.statusBar.hideWaitingAssertionRetriesStatus(t.success).then(function(){return e._onReady(new Ti({isCommandResult:!0}))})},Cl.prototype._checkStatus=function(){var r=this;return y.browser.checkStatus(this.browserStatusDoneUrl,o.createNativeXHR,{manualRedirect:!0}).then(function(t){var e=t.command,n=t.redirecting;n&&e.url.indexOf(r.testRunId)<0?(nl.clear(),nl.lock()):r.contextStorage.setItem(ol,!1),n?y.browser.redirect(e):r._onReady({isCommandResult:!1})}).catch(function(){return y.delay(1e3)})},Cl.prototype._onCustomCommand=function(t){var e=this;(0,this.customCommandHandlers[t.type].handler)(t).then(function(t){e._onReady(new Ti({isCommandResult:!0,result:t}))})},Cl.prototype._closeAllChildWindows=function(){var t=this;return this.childWindowDriverLinks.length?tl.all(this.childWindowDriverLinks.map(function(t){return t.closeAllChildWindows()})).then(function(){rl.arrayForEach.call(t.childWindowDriverLinks,function(t){t.driverWindow.close()})}):tl.resolve()},Cl.prototype._onTestDone=function(t){var e=this;this.contextStorage.setItem(ol,!0),this.parentWindowDriverLink?this._switchToTopParentWindow():this._closeAllChildWindows().then(function(){return e._sendStatus(t)}).then(function(){e._checkStatus()}).catch(function(){e._onReady(new Ti({isCommandResult:!0,executionError:Gr}))})},Cl.prototype._onBackupStoragesCommand=function(){this._onReady(new Ti({isCommandResult:!0,result:nl.backup()}))},Cl.prototype._isStatusWithCommandResultInPendingWindowSwitchingMode=function(t){return t.isCommandResult&&!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},Cl.prototype._isEmptyCommandInPendingWindowSwitchingMode=function(t){return!t&&!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},Cl.prototype._onReady=function(t){var e=this;this._isStatusWithCommandResultInPendingWindowSwitchingMode(t)&&this.emit(wl),this._sendStatus(t).then(function(t){if(t)e._onCommand(t);else{if(e._isEmptyCommandInPendingWindowSwitchingMode(t))return void e.emit(yl);e._onReady(new Ti)}})},Cl.prototype._executeCommand=function(t){this.customCommandHandlers[t.type]?this._onCustomCommand(t):t.type===u.testDone?this._onTestDone(new Ti({isCommandResult:!0})):t.type===u.setBreakpoint?this._onSetBreakpointCommand(t.isTestError):t.type===u.switchToMainWindow?this._onSwitchToMainWindowCommand(t):t.type===u.switchToIframe?this._onSwitchToIframeCommand(t):t.type===u.openWindow?this._onWindowOpenCommand(t):t.type===u.closeWindow?this._onWindowCloseCommand(t):t.type===u.getCurrentWindow?this._onGetCurrentWindowCommand(t):t.type===u.switchToWindow?this._onSwitchToWindow(t):At(t)?this._onBrowserManipulationCommand(t):t.type===u.executeClientFunction?this._onExecuteClientFunctionCommand(t):t.type===u.executeSelector?this._onExecuteSelectorCommand(t):t.type===u.navigateTo?this._onNavigateToCommand(t):t.type===u.setNativeDialogHandler?this._onSetNativeDialogHandlerCommand(t):t.type===u.getNativeDialogHistory?this._onGetNativeDialogHistoryCommand(t):t.type===u.getBrowserConsoleMessages?this._onGetBrowserConsoleMessagesCommand(t):t.type===u.setTestSpeed?this._onSetTestSpeedCommand(t):t.type===u.showAssertionRetriesStatus?this._onShowAssertionRetriesStatusCommand(t):t.type===u.hideAssertionRetriesStatus?this._onHideAssertionRetriesStatusCommand(t):t.type===u.backupStorages?this._onBackupStoragesCommand():this._onActionCommand(t)},Cl.prototype._isExecutableInTopWindowOnly=function(t){if((e=t).type===u.testDone||e.type===u.switchToMainWindow||e.type===u.setNativeDialogHandler||e.type===u.getNativeDialogHistory||e.type===u.setTestSpeed||e.type===u.showAssertionRetriesStatus||e.type===u.hideAssertionRetriesStatus||e.type===u.setBreakpoint||At(e)&&e.type!==u.takeElementScreenshot)return!0;var e,n=this.customCommandHandlers[t.type];return t.forceExecutionInTopWindowOnly||n&&n.isExecutableInTopWindowOnly},Cl.prototype._onCommand=function(n){var r=this;this.readyPromise.then(function(){var t,e=Mt(n);r.contextStorage.getItem(cl)&&e?r._onReady(new Ti({isCommandResult:!0})):(t=r.activeChildIframeDriverLink||r.contextStorage.getItem(ul),r._isExecutableInTopWindowOnly(n)||!t?r._executeCommand(n):r._runInActiveIframe(n))})},Cl.prototype.setCustomCommandHandlers=function(t,e,n){this.customCommandHandlers[t]={isExecutableInTopWindowOnly:n,handler:e}},Cl.prototype._startInternal=function(t){this.role=Ja,y.browser.startHeartbeat(this.heartbeatUrl,o.createNativeXHR),this._setupAssertionRetryIndication(),this._startCommandsProcessing(t)},Cl.prototype._stopInternal=function(){this.role=$a,y.browser.stopHeartbeat(),_.cursor.hide()},Cl.prototype._setupAssertionRetryIndication=function(){var n=this;this.readyPromise.then(function(){n.statusBar.hidePageLoadingStatus();var t,e=n.contextStorage.getItem(hl);e&&(t=n.contextStorage.getItem(fl),0<e-(new Date-t)&&n.statusBar.showWaitingAssertionRetriesStatus(e,t))})},Cl.prototype._startCommandsProcessing=function(t){void 0===t&&(t={finalizePendingCommand:!1,isFirstRequestAfterWindowSwitching:!1});var e,n,r=this.contextStorage.getItem(sl);r&&(r.resent=!0),this.contextStorage.getItem(ol)?r?this._onTestDone(r):this._checkStatus():this._failIfClientCodeExecutionIsInterrupted()||(e=t.finalizePendingCommand||this._hasPendingActionFlags(this.contextStorage),n=r||new Ti({isCommandResult:e,isFirstRequestAfterWindowSwitching:t.isFirstRequestAfterWindowSwitching}),this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!1),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!1),this._onReady(n))},Cl.prototype._initParentWindowLink=function(){Hl.opener&&(this.parentWindowDriverLink=new qa(Hl))},Cl.prototype._initConsoleMessages=function(){var t=this.consoleMessages;t.ensureMessageContainer(this.windowId),this.consoleMessages=t},Cl.prototype._getDriverRole=function(){var e=this;return this.windowId?y.browser.getActiveWindowId(this.browserActiveWindowId,o.createNativeXHR).then(function(t){return t.activeWindowId===e.windowId?Ja:$a}):tl.resolve(Ja)},Cl.prototype._init=function(){this.contextStorage=new ds(Hl,this.testRunId,this.windowId),this.nativeDialogsTracker=new go(this.contextStorage,this.dialogHandler),this.statusBar=new n.StatusBar(this.userAgent,this.fixtureName,this.testName,this.contextStorage),this.statusBar.on(this.statusBar.UNLOCK_PAGE_BTN_CLICK,y.disableRealEventsPreventing),this.speed=this.initialSpeed,this._initConsoleMessages()},Cl.prototype._doFirstPageLoadSetup=function(){return this.isFirstPageLoad&&this.canUseDefaultWindowActions,tl.resolve()},Cl.prototype.start=function(){var e=this;this._init(),this._doFirstPageLoadSetup().then(function(){return e._getDriverRole()}).then(function(t){t===Ja?e._startInternal():e._initParentWindowLink()})},Cl);function Cl(t,e,n,r){var i=Ka.call(this)||this;return i.COMMAND_EXECUTING_FLAG="testcafe|driver|command-executing-flag",i.EXECUTING_IN_IFRAME_FLAG="testcafe|driver|executing-in-iframe-flag",i.PENDING_WINDOW_SWITCHING_FLAG="testcafe|driver|pending-window-switching-flag",i.testRunId=t,i.heartbeatUrl=e.heartbeat,i.browserStatusUrl=e.status,i.browserStatusDoneUrl=e.statusDone,i.browserActiveWindowId=e.activeWindowId,i.userAgent=n.userAgent,i.fixtureName=n.fixtureName,i.testName=n.testName,i.selectorTimeout=r.selectorTimeout,i.pageLoadTimeout=r.pageLoadTimeout,i.childWindowReadyTimeout=r.childWindowReadyTimeout,i.initialSpeed=r.speed,i.skipJsErrors=r.skipJsErrors,i.dialogHandler=r.dialogHandler,i.canUseDefaultWindowActions=r.canUseDefaultWindowActions,i.isFirstPageLoad=Qa.get().isFirstPageLoad,i.customCommandHandlers={},i.contextStorage=null,i.nativeDialogsTracker=null,i.childIframeDriverLinks=[],i.activeChildIframeDriverLink=null,i.childWindowDriverLinks=[],i.parentWindowDriverLink=null,i.statusBar=null,i.windowId=i._getCurrentWindowId(),i.role=$a,i.setAsMasterInProgress=!1,i.checkClosedChildWindowIntervalId=null,r.retryTestPages&&y.browser.enableRetryingTestPages(),i.pageInitialRequestBarrier=new y.RequestBarrier,i.readyPromise=y.eventUtils.documentReady(i.pageLoadTimeout).then(function(){return i.pageInitialRequestBarrier.wait(!0)}),i._openWindowPromiseResolveFn=function(){},i._initChildDriverListening(),y.pageUnloadBarrier.init(),y.preventRealEvents(),o.on(o.EVENTS.uncaughtJsError,function(t){return i._onJsError(t)}),o.on(o.EVENTS.unhandledRejection,function(t){return i._onJsError(t)}),o.on(o.EVENTS.consoleMethCalled,function(t){return i._onConsoleMessage(t)}),o.on(o.EVENTS.beforeFormSubmit,function(t){return i._onFormSubmit(t)}),o.on(o.EVENTS.windowOpened,function(t){return i._onChildWindowOpened(t)}),i.setCustomCommandHandlers(u.unlockPage,function(){return i._unlockPageAfterTestIsDone()}),i}var Il=(Sl.prototype.establishConnection=function(){return fs(new No,this.driverWindow,5e3,Dr).then(function(t){return t.result.id})},Sl.prototype.sendConfirmationMessage=function(t){ps({requestMsgId:t,window:this.driverWindow})},Sl.prototype.onCommandExecuted=function(t){var e=new jo(t);l.eventSandbox.message.sendServiceMsg(e,this.driverWindow)},Sl);function Sl(t){this.driverWindow=t}var Tl,bl=o.eventSandbox.message,Wl=(i(xl,Tl=go),xl.prototype._defaultDialogHandler=function(t){bl.sendServiceMsg({type:so,dialogType:t,url:go._getPageUrl()},Hl.top)},xl.prototype._addAppearedDialogs=function(t,e){bl.sendServiceMsg({type:oo,dialogType:t,text:e,url:go._getPageUrl()},Hl.top)},xl.prototype._onHandlerError=function(t,e){bl.sendServiceMsg({type:ao,dialogType:t,message:e,url:go._getPageUrl()},Hl.top)},xl);function xl(t){return Tl.call(this,null,t)||this}var Dl,Rl=(i(Nl,Dl=El),Nl.prototype._onJsError=function(){},Nl.prototype._onConsoleMessage=function(){},Nl.prototype._initParentDriverListening=function(){var n=this;l.eventSandbox.message.on(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message;y.pageUnloadBarrier.wait(0).then(function(){if(e.type===bo){if(n.lastParentDriverMessageId===e.id)return;n.lastParentDriverMessageId=e.id,n.readyPromise.then(function(){n.speed=e.testSpeed,n.parentDriverLink.sendConfirmationMessage(e.id),n._onCommand(e.command)})}e.type===xo&&(n.nativeDialogsTracker.setHandler(e.dialogHandler),n._setNativeDialogHandlerInIframes(e.dialogHandler))})})},Nl.prototype._onSwitchToMainWindowCommand=function(t){this._switchToMainWindow(t)},Nl.prototype._onReady=function(t){this.parentDriverLink.onCommandExecuted(t)},Nl.prototype.start=function(){var e=this;this.nativeDialogsTracker=new Wl(this.dialogHandler),this.statusBar=new n.IframeStatusBar;var t=this.parentDriverLink.establishConnection().then(function(t){e.contextStorage=new ds(Hl,t,e.windowId),e._failIfClientCodeExecutionIsInterrupted()||(e.contextStorage.getItem(e.COMMAND_EXECUTING_FLAG)||e.contextStorage.getItem(e.EXECUTING_IN_IFRAME_FLAG))&&(e.contextStorage.setItem(e.COMMAND_EXECUTING_FLAG,!1),e.contextStorage.setItem(e.EXECUTING_IN_IFRAME_FLAG,!1),e._onReady(new Ti({isCommandResult:!0})))});this.readyPromise=l.Promise.all([this.readyPromise,t])},Nl);function Nl(t,e){var n=Dl.call(this,t,{},{},e)||this;return n.lastParentDriverMessageId=null,n.parentDriverLink=new Il(Hl.parent),n._initParentDriverListening(),n}var Ml={NodeSnapshot:Li,ElementSnapshot:zi,SelectorExecutor:Gs},Pl="%testCafeDriver%",Al="%testCafeIframeDriver%",kl="%ScriptExecutionBarrier%",Fl="%testCafeEmbeddingUtils%",Ll=o.nativeMethods,Ol=o.EVENTS.evalIframeScript;Ll.objectDefineProperty(Hl,Pl,{configurable:!0,value:El}),Ll.objectDefineProperty(Hl,Al,{configurable:!0,value:Rl}),Ll.objectDefineProperty(Hl,kl,{configurable:!0,value:_s}),Ll.objectDefineProperty(Hl,Fl,{configurable:!0,value:Ml}),o.on(Ol,function(t){return Ul(Ll.contentWindowGetter.call(t.iframe))})}(Hl["%hammerhead%"],Hl["%hammerhead%"].Promise,Hl["%testCafeCore%"],Hl["%testCafeAutomation%"],Hl["%testCafeUI%"])}(window);